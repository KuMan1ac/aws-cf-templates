# Sophos UTM on AWS Release Notes

## Sophos UTM 9.506 on AWS

### AWS Firmware

* [UTM on AWS 9.506 Release Notes](https://community.sophos.com/products/unified-threat-management/b/utm-blog/posts/sophos-utm-9-506-on-aws-release-notes)
* [UTM 9.506 Release Notes](https://community.sophos.com/products/unified-threat-management/b/utm-blog/posts/utm-up2date-9-506-released)

### Templates

The following templates were changed in this release:

|Feature|Template|Template Changes|
|-------|--------|----------------|
|HA Standalone|[ha_standalone.template](https://github.com/sophos-iaas/aws-cf-templates/blob/master/utm/9.506/ha_standalone.template)| [Show diff](https://github.com/sophos-iaas/aws-cf-templates/compare/utm9.501...utm9.506)|
|HA Warm Standby|[ha_warm_standby.template](https://github.com/sophos-iaas/aws-cf-templates/blob/master/utm/9.506/ha_warm_standby.template)| [Show diff](https://github.com/sophos-iaas/aws-cf-templates/compare/utm9.501...utm9.506)|
|Standalone|[standalone.template](https://github.com/sophos-iaas/aws-cf-templates/blob/master/utm/9.506/standalone.template)|[Show diff](https://github.com/sophos-iaas/aws-cf-templates/compare/utm9.501...utm9.506)|
|Auto Scaling|[autoscaling.template](https://github.com/sophos-iaas/aws-cf-templates/blob/master/utm/9.506/autoscaling.template)|[Show diff](https://github.com/sophos-iaas/aws-cf-templates/compare/utm9.501...utm9.506)|

#### Mandatory Changes

|Change|Template|Line(s)|Description|
|------|--------|-----|-----------|
|AMI ID changes|autoscaling.template|466-565|Changes AMI to UTM 9.506 AMI|
| |ha_standalone.template|477-562|Changes AMI to UTM 9.506 AMI|
| |ha_warm_standby.template|477-562|Changes AMI to UTM 9.506 AMI|
| |standalone.template|136-229|Changes AMI to UTM 9.506 AMI|
|Instance Sizes|autoscaling.template|2220|Fixed a bug in choosing the correct default instance type|
|NUTM-7925|autoscaling.template|640-868, 904-1280|Reduced necessary permissions for UTM Auto Scaling deployment and extracted OGW permissions|
|NUTM-7925|iam_profile.template|all|Added template for simplifying creation of AWS Profile permissions needed for OGW deployment and monitoring|
|NUTM-7741|autoscaling.template|2045-2074, 2261-2327, new: 2512-2548|Removed sensitive information from UserData|
| |ha_standalone.template|1125-1274, new: 1147-1324|Removed sensitive information from UserData|
| |ha_warm_standby.template|1125-1274, new: 1147-1324|Removed sensitive information from UserData|

#### Optional Changes

|Change|Template|Line(s)|Description|
|------|--------|-----|-------------|
|Instance Sizes|autoscaling.template|23-27|Use a default instance type that's supported in all regions|

## Sophos UTM 9.501 on AWS

### AWS Firmware

* [UTM on AWS 9.501 Release Notes](https://community.sophos.com/products/unified-threat-management/b/utm-blog/posts/sophos-utm-9-501-on-aws-release-notes)
* [UTM 9.501 Release Notes](https://community.sophos.com/products/unified-threat-management/b/utm-blog/posts/utm-up2date-9-501-released)

### Templates

The following templates were changed in this release:

|Feature|Template|Template Changes|
|-------|--------|----------------|
|HA Standalone|[ha_standalone.template](https://github.com/sophos-iaas/aws-cf-templates/blob/master/utm/9.501/ha_standalone.template)| [Show diff](https://github.com/sophos-iaas/aws-cf-templates/compare/utm9.411...utm9.501)|
|HA Warm Standby|[ha_warm_standby.template](https://github.com/sophos-iaas/aws-cf-templates/blob/master/utm/9.501/ha_warm_standby.template)| [Show diff](https://github.com/sophos-iaas/aws-cf-templates/compare/utm9.411...utm9.501)|
|Standalone|[standalone.template](https://github.com/sophos-iaas/aws-cf-templates/blob/master/utm/9.501/standalone.template)|[Show diff](https://github.com/sophos-iaas/aws-cf-templates/compare/utm9.411...utm9.501)|
|Auto Scaling|[autoscaling.template](https://github.com/sophos-iaas/aws-cf-templates/blob/master/utm/9.501/autoscaling.template)|[Show diff](https://github.com/sophos-iaas/aws-cf-templates/compare/utm9.411...utm9.501)|

#### Mandatory Changes

|Change|Template|Line(s)|Description|
|------|--------|-----|-----------|
|AMI ID changes|autoscaling.template|463-571|Changes AMI to UTM 9.501 AMI|
| |ha_standalone.template|474-566|Changes AMI to UTM 9.501 AMI|
| |ha_warm_standby.template|474-566|Changes AMI to UTM 9.501 AMI|
| |standalone.template|136-240|Changes AMI to UTM 9.501 AMI|
|Removal of SNS|autoscaling.template|653-659, 1013-1019, 1658-1660, 1841, 2069, 2105, 2139-2143, 2165-2191, 2201, 2434-2438, 2676-2680, 2732-2737|The usage of AWS SNS was removed completely|
|NUTM-6607|autoscaling.template|2067-2068, 2144, 2319-2320, 2375||
|AWS logs agent as RPM|autoscaling.template|2093, 2363-2370, 2492, 2494| Installation and provisioning of AWS logs agent has been removed due to installation as RPM|
||ha_standalone.template <br/> ha_warm_standby.template|1226, 1267, 1271-1277||
|Auto-managed/non-managed Security Groups|autoscaling.template|2558, 2566-2570||
|Increased pause time/health check grace period|autoscaling.template|1850, 1855, 2209, 2215| Increased pause time and added a health check grace period in order to stabilize deployment|
||ha_standalone.template <br/> ha_warm_standby.template|1003| Added a health check grace period in order to stabilize deployment|

#### Optional Changes

|Change|Template|Line(s)|Description|
|------|--------|-----|-------------|
|NONE|||||

## Sophos UTM 9.411 on AWS

### AWS Firmware

FEATURES:

* NUTM-5430: [AWS] Support for ELB Proxy Protocol
* NUTM-6186: [AWS] Logging to CloudWatch Logs Agent
* NUTM-6417: [AWS] New CloudFormation template baseline for future stack updates

BUGFIXES:

* NUTM-534 [AWS] Template update notification
* NUTM-6178 [AWS] pg_xlog directory filling up on AWS deployments
* NUTM-6186 [AWS] Make all UTM logs available in AWS CloudWatch
* NUTM-6224 [AWS] awslogs daemon init script: restart broken
* NUTM-6296 [AWS] REST API doesn't work in cluster mode
* NUTM-6402 [AWS] [RESTD] Session is not closed after token is deleted
* NUTM-6804 [AWS] Update breaks HVM standalone installations
* NUTM-6165 [WAF] Additional cookie from WAF is added without HttpOnly detail

These are only the changes relevant to UTM running in an AWS enviroment. For a full list of all UTM changes in this release check out the following release notes:
* [UTM 9.410 Release Notes](https://community.sophos.com/products/unified-threat-management/b/utm-blog/posts/utm-up2date-9-410-released)
* [UTM 9.411 Release Notes](https://community.sophos.com/products/unified-threat-management/b/utm-blog/posts/utm-up2date-9-411-released)


### Templates

The following templates were changed in this release:

|Feature|Template|Template Changes|
|-------|--------|----------------|
|HA Standalone|[ha_standalone.template](https://github.com/sophos-iaas/aws-cf-templates/blob/master/utm/9.411/ha_standalone.template)|[Diff of ha_standalone.template](https://github.com/sophos-iaas/aws-cf-templates/compare/utm9.409...utm9.411)|
|HA Warm Standby|[ha_warm_standby.template](https://github.com/sophos-iaas/aws-cf-templates/blob/master/utm/9.411/ha_warm_standby.template)|[Diff of ha_warm_standby.template](https://github.com/sophos-iaas/aws-cf-templates/compare/utm9.409...utm9.411)| |
|Standalone|[standalone.template](https://github.com/sophos-iaas/aws-cf-templates/blob/master/utm/9.411/standalone.template)|[Diff of standalone.template](https://github.com/sophos-iaas/aws-cf-templates/compare/utm9.409...utm9.411)|
|Auto Scaling|[autoscaling.template](https://github.com/sophos-iaas/aws-cf-templates/blob/master/utm/9.411/autoscaling.template)|[Diff of autoscaling.template](https://github.com/sophos-iaas/aws-cf-templates/compare/utm9.409...utm9.411)|

#### Mandatory Changes

|Change|Template|Line(s)|Description|
|------|--------|-----|-----------|
|AMI ID changes|autoscaling.template|444–445, 451–452, 458–459, 465–466, 472–473, 479–480, 486–487, 493–494, 500–501, 507–508, 514–515, 521–522, 528–529, 535–536, 542–543|Changes AMI to UTM 9.411 AMI|
| |ha_standalone.template|435–436, 441–442, 447–448, 453–554, 459–460, 465–466, 471–472, 477–478, 483–484, 489–490, 495–496, 501–502, 507–508, 513–514, 519–520|Changes AMI to UTM 9.411 AMI|
| |ha_warm_standby.template|435–436, 441–442, 447–448, 453–454, 459–460, 465–466, 471–472, 477–478, 483–484, 489–490, 495–496, 501–502, 507–508, 513–514, 519–520|Changes AMI to UTM 9.411 AMI|
| |standalone.template|140–141, 146–147, 152–153, 158–159, 164–165, 170–171, 176–177, 182–183, 188–189, 194–195, 200–201, 206–207, 212–213, 218–219, 224–225|Changes AMI to UTM 9.411 AMI|
|Adds awscli because it is needed in this version|autoscaling.template|2093|Code change to install awscli|

#### Optional Changes

|Change|Template|Line(s)|Description|
|------|--------|-----|-------------|
|Proxy Protocol Support|autoscaling.template|1004–1008|Policy change for elastic loadbalancer|
| | |1822–1834|Proxy Protocol configuration for elastic loadbalancer|
|Postgres Sync|autoscaling.template|763–871|S3 buckets and access policies for Postgres sync feature|
| | |1638–1652|Configuration of S3 bucktes|
|New regions|egw.template|166–169|Region ca-central-1 (Canada) was added|
| | |181–185|Region eu-west-2 (London) was added|
|Wording fixes|autoscaling.template|6, 11, 20, 25, 57, 356, 385, 388, 391, 394, 397, 400, 403, 406, 418, 421, 424, 427, 430, 433, 436|Changes wording|
| |ha_standalone.template|6, 11, 20, 52, 350, 379, 382, 385, 388, 391, 394, 397, 409, 412, 415, 418, 421, 424, 427, 1297|Changes wording|
| |ha_warm_standby.template|6, 11, 20, 52, 350, 379, 382, 385, 388, 391, 394, 397, 409, 412, 415, 418, 421, 424, 427, 1296|Changes wording|
| |standalone.template|6, 11, 21, 51, 79, 102, 105, 108, 111, 114, 117, 120, 123, 129|Changes wording|
| |egw.template|22|Changes wording|
|Trusted network validation|autoscaling.template|44|Adds regex for network validation|
| |ha_standalone.template|39|Adds regex for network validation|
| |ha_warm_standby.template|39|Adds regex for network validation|
| |standalone.template|35–36, 42–43|Adds regex for network validation|
|Default licensing mode|autoscaling.template|16–17|Removes hourly as default licensing mode|
| |ha_standalone.template|16–17|Removes hourly as default licensing mode|
| |ha_warm_standby.template|16–17|Removes hourly as default licensing mode|
| |standalone.template|16–17|Removes hourly as default licensing mode|
|Debug Mode|autoscaling.template|340–348|Adds parameter for enabling/disabling debug mode|
| | |392–399|Adds label for debug mode parameter|
| | |2349–2353|Code change for applying debug mode|
| | |2473–2477|Code change for applying debug mode|
| |ha_standalone.template|344–352|Adds parameter for enabling/disabling debug mode|
| | |403–410|Adds label for debug mode parameter|
| | |468–469|Adds parameter for debug mode|
| | |1188–1192|Code change for applying debug mode|
| |ha_warm_standby.template|344–352|Adds parameter for enabling/disabling debug mode|
| | |403–410|Adds label for debug mode parameter|
| | |1188–1192|Code change for applying debug mode|
|Instance size change|autoscaling.template|448|Changes swarm instance size in ap-northeast-1 from m3.medium to c4.large|
| | |469|Changes swarm instance size in ap-southeast-1 from m3.medium to c4.large|
| | |476|Changes swarm instance size in ap-southeast-2 from m3.medium to c4.large|
| | |490|Changes swarm instance size in eu-central-1 from m3.medium to c4.large|
| | |511|Changes swarm instance size in sa-east-1 from m3.medium to c4.large|
| | |518|Changes swarm instance size in us-east-1 from m3.medium to c4.large|
| | |531–532|Changes queen instance size from m3.medium to m4.large and swarm instance size from m3.medium to c4.large in us-gov-west-1|
| | |539|Changes swarm instance size in us-west-1 from m3.medium to c4.large|
| | |546|Changes swarm instance size in us-west-2 from m3.medium to c4.large|
| |ha_standalone.template|438|Changes HA instance size from m3.medium to c4.large in ap-northeast-1|
| | |450|Changes HA instance size from m4.large to c4.large in ap-south-1|
| | |456|Changes HA instance size from m3.medium to c4.large in ap-southeast-1|
| | |462|Changes HA instance size from m3.medium to c4.large in ap-southeast-2|
| | |468|Changes HA instance size from m4.large to c4.large in ca-central-1|
| | |474|Changes HA instance size from m3.medium to c4.large in eu-central-1|
| | |480|Changes HA instance size from m4.large to c4.large in eu-west-1|
| | |486|Changes HA instance size from m4.large to c4.large in eu-west-2|
| | |492|Changes HA instance size from m3.medium to m3.large in sa-east-1|
| | |498|Changes HA instance size from m3.medium to c4.large in us-east-1|
| | |504|Changes HA instance size from m4.large to c4.large in us-east-2|
| | |510|Changes HA instance size from m3.medium to c4.large in us-gov-west-1|
| | |516|Changes HA instance size from m3.medium to c4.large in us-west-1|
| | |522|Changes HA instance size from m3.medium to c4.large in us-west-2|
| |ha_warm_standby.template|438|Changes HA instance size from m3.medium to c4.large in ap-northeast-1|
| | |450|Changes HA instance size from m4.large to c4.large in ap-south-1|
| | |456|Changes HA instance size from m3.medium to c4.large in ap-southeast-1|
| | |462|Changes HA instance size from m3.medium to c4.large in ap-southeast-2|
| | |468|Changes HA instance size from m4.large to c4.large in ca-central-1|
| | |474|Changes HA instance size from m3.medium to c4.large in eu-central-1|
| | |480|Changes HA instance size from m4.large to c4.large in eu-west-1|
| | |486|Changes HA instance size from m4.large to c4.large in eu-west-2|
| | |492|Changes HA instance size from m3.medium to m3.large in sa-east-1|
| | |498|Changes HA instance size from m3.medium to c4.large in us-east-1|
| | |504|Changes HA instance size from m4.large to c4.large in us-east-2|
| | |510|Changes HA instance size from m3.medium to c4.large in us-gov-west-1|
| | |516|Changes HA instance size from m3.medium to c4.large in us-west-1|
| | |522|Changes HA instance size from m3.medium to c4.large in us-west-2|
| |standalone.template|143|Changes HA instance size from m3.medium to c4.large in ap-northeast-1|
| | |155|Changes HA instance size from m4.large to c4.large in ap-south-1|
| | |161|Changes HA instance size from m3.medium to c4.large in ap-southeast-1|
| | |167|Changes HA instance size from m3.medium to c4.large in ap-southeast-2|
| | |173|Changes HA instance size from m4.large to c4.large in ca-central-1|
| | |179|Changes HA instance size from m3.medium to c4.large in eu-central-1|
| | |185|Changes HA instance size from m4.large to c4.large in eu-west-1|
| | |191|Changes HA instance size from m4.large to c4.large in eu-west-2|
| | |197|Changes HA instance size from m3.medium to m3.large in sa-east-1|
| | |203|Changes HA instance size from m3.medium to c4.large in us-east-1|
| | |209|Changes HA instance size from m4.medium to c4.large in us-east-2|
| | |215|Changes HA instance size from m3.medium to c4.large in us-gov-west-1|
| | |221|Changes HA instance size from m3.medium to c4.large in us-west-1|
| | |227|Changes HA instance size from m3.medium to c4.large in us-west-2|
| |egw.template|158–159|Changes EGW instance size from m3.medium to c4.large in ap-southeast-1|
| | |163–164|Changes EGW instance size from m3.medium to c4.large in ap-southeast-2|
| | |173–174|Changes EGW instance size from m3.medium to c4.large in eu-central-1|
| | |178–179|Changes EGW instance size from m3.medium to c4.large in us-east-1|
| | |188–189|Changes EGW instance size from m3.medium to c4.large in us-west-1|
|HA template unification|ha_standalone.template|5–13|Adds HA mode dropdown for "Cold" or "Warm" standby|
| | |360–367|Adds HA mode parameter|
| | |414–416|Adds label for HA mode parameter|
| | |567–578|Adds maps containing data for HA mode|
| | |994–1002|Property definition for HA mode|
| | |1004–1012|Property definition for HA mode|
| | |1128–1149|Code changes for HA mode unification|
| |ha_warm_standby.template|5–13|Adds HA mode dropdown for "Cold" or "Warm" standby|
| | |360–367|Adds HA mode parameter|
| | |414–416|Adds label for HA mode parameter|
| | |567–578|Adds maps containing data for HA mode|
| | |994–1002|Property definition for HA mode|
| | |1004–1012|Property definition for HA mode|
| | |1128–1149|Code changes for HA mode unification|

## Sophos UTM 9.410 on AWS

UTM version 9.410 was not released for AWS environements.

*Note: Features/fixes from this version were incorporated into the 9.411 UTM on AWS release.*

## Sophos UTM 9.409 on AWS

### AWS Firmware

FEATURES:

* NUTM-6328: [AWS] UTM available in the Canada region
* NUTM-6243: Ruby GEM for REST API
* NUTM-5320: Chef cookbook for Sophos UTM

BUGFIXES:

* NUTM-2392: [AWS] Allow the user to select the security group to port during conversion
* NUTM-5327: [AWS] Confd object missing after instance recovery in HA scenario
* NUTM-5339: [AWS] [RESTD] allow unauthenticated access from localhost
* NUTM-5466: [AWS] ssh disabled: No connection to stack instances
* NUTM-5882: [AWS] Logging & Reporting overview does not show any information
* NUTM-5901: [AWS] [RESTD] Improve webadmin UI and documentation
* NUTM-5981: [AWS] Conversion feature always converts to BYOL
* NUTM-6013: [AWS] Fix communication issue with S3
* NUTM-5792: [WAF] WAF coredump'ed after regular session cleanup
* NUTM-5856: [WAF] Special characters are encoded when HTML rewrite is enabled

These are only the changes relevant to AWS. For a full list of all UTM changes in this release check out the [complete UTM 9.409 Release Notes](https://community.sophos.com/products/unified-threat-management/f/hardware-installation-up2date-licensing/84536/sophos-utm-9-409-8-and-9-409-9-released)

### Templates

The following templates were changed in this release:

|Feature|Template|Template Changes|
|-------|--------|----------------|
|HA Standalone|[ha_standalone.template](https://github.com/sophos-iaas/aws-cf-templates/blob/master/utm/9.409/ha_standalone.template)|[Diff of ha_standalone.template](https://github.com/sophos-iaas/aws-cf-templates/compare/utm9.408...utm9.409#diff-cbe587802139c4ef30dac678d781e2df)|
|HA Warm Standby|[ha_warm_standby.template](https://github.com/sophos-iaas/aws-cf-templates/blob/master/utm/9.409/ha_warm_standby.template)|[Diff of ha_warm_standby.template](https://github.com/sophos-iaas/aws-cf-templates/compare/utm9.408...utm9.409#diff-897f1f6c4dcaf0f295a1a9f1610b1c23)| |
|Standalone|[standalone.template](https://github.com/sophos-iaas/aws-cf-templates/blob/master/utm/9.409/standalone.template)|[Diff of standalone.template](https://github.com/sophos-iaas/aws-cf-templates/compare/utm9.408...utm9.409#diff-68e43ab49c02f82246e254d7b99adbbd)|

#### Mandatory Changes

|Change|Template|Line(s)|Description|
|------|--------|-----|-----------|
|Update AMI ID to use new UTM Firmware version|ha_standalone.template|435–436, 441–442, 447–448, 453–454, 459–460, 477–478, 489–490, 495–496, 501–502, 507–508, 513–514, 519–520|Changes AMI ID|
| |ha_warm_standby.template|435–436, 441–442, 447–448, 453–454, 459–460, 471–472, 477–478, 489–490, 495–496, 501–502, 507–508, 513–514, 519–520|Changes AMI ID|
| |standalone.template|140–141, 146–147, 152–153, 158–159, 164–165, 176–177, 182–183, 194–195, 200–201, 206–207, 212–213, 218–219, 224–225|Changes AMI ID|

#### Optional Changes

|Change|Template|Line(s)|Description|
|------|--------|-------|-----------|
|Optimizes instance sizes for some roles for improved performance/cost|ha_standalone.template|450|Changes ap-south-1 instance type from c4.large to m4.large|
| | |474|Changes eu-west-1 instance type from m3.medium to m4.large|
| |ha_warm_standby.template|450|Changes ap-south-1 instance type from c4.large to m4.large|
| | |474|Changes eu-west-1 instance type from m3.medium to m4.large|
| | |492|Changes us-east-2 instance type from c4.large to m4.large|
| |standalone.template|155|Changes ap-south-1 instance type from c4.large to m4.large|
| | |179|Changes eu-west-1 instance type from m3.medium to m4.large|
| | |197|Changes us-east-2 instance type from c4.large to m4.large|
|Adds new AWS regions Canada Central and London|ha_standalone.template|464–469|Adds configuration for ca-central-1 (Canada)|
| | |482–486|Adds configuration for eu-west-2 (London)|
| |ha_warm_standby.template|169–174|Adds configuraton for ca-central-1 (Canada)|
| | |482–486|Adds configuration for eu-west-2 (London)|
| |standalone.template|169–174|Adds configuration for ca-central-1 (Canada)|
| | |187–191|Adds configuration for eu-west-2 (London)|

## Sophos UTM 9.408 on AWS

See the [Sophos UTM on AWS 9.408 release notes](https://community.sophos.com/products/unified-threat-management/b/utm-blog/posts/sophos-utm-9-408-on-aws-release-notes).

## Sophos UTM 9.404 on AWS

See the [Sophos UTM on AWS 9.404 release notes](https://community.sophos.com/products/unified-threat-management/b/utm-blog/posts/sophos-utm-9-404-on-aws-release-notes).
